const QuestionPaper = require("../models/questionPaper.model");
const {extractQuestions, extractRubrics} = require("../services/questionPaperService");

const handlePostPaperSave = async(req, res) => {
   try {
      const {title, subject} = req.body;
      
      const { path, mimetype } = req.file
      

      // currently rubrics are generated by gemini
      // TODO: add rubrics upload support in frontend
      
      const [questions, rubrics] = await Promise.all([
         extractQuestions(path, mimetype),
         extractRubrics(path, mimetype)
      ])
      
      const newPaper = new QuestionPaper({
         title: title || "untitled",
         subject: subject || "undefined",
         questions: Array.isArray(questions?.questions) ? [...questions.questions] : [],
         rubrics: Array.isArray(rubrics?.rubrics) ? [...rubrics.rubrics] : [],
      });

      console.dir(newPaper, { depth: null });
      
      // TODO: complete the code for creating db entry and sending response

      // await newPaper.save()
      res.status(201).json()
   } catch (error) {
      console.error(error.message);
      
   }
}

module.exports = handlePostPaperSave